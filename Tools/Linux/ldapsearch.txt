Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2020-02-27T14:56:15-05:00

====== ldapsearch ======
Created Thursday 27 February 2020

===== Description =====

Performs search queries on an LDAP server

===== Website =====
https://docs.ldap.com/ldap-sdk/docs/tool-usages/ldapsearch.html

===== Installation =====
* Kali: Installed  by default

===== Usage =====
{{{code: lang="sh" linenumbers="False"
ldapsearch <options> <filter>
}}}


===== Options =====
{{{code: lang="texinfo" linenumbers="False"
-L																Search results are display in LDAP Data Interchange Format v1
-LL																Removes comments from resulset
-LLL															disables printing of the LDIF version
-H ldap[s]://<host>:<port>										Connects to the specfied host
-h <host>														Specifies LDAP host to connect to
-p <port>														Specify port of LDAP server
-D <binddn>														The Distinguished Name of the user ldap will bind to. (run query as)
-w <passwd>														Specifiy the password of the user specified under -D
-W 																Asks for password
-b <searchbase>													The base to search from eg "dc=corp,dc=com" (domain)

<filter>														Proper LDAP filter. (experiment)
}}}



===== Filters =====

==== Find all users ====
{{{code: lang="texinfo" linenumbers="False"
sAMAccountType=805306368
}}}


==== Find all computers ====
{{{code: lang="texinfo" linenumbers="False"
(objectCategory=computer)
}}}

 	

==== Find all domain objects ====
{{{code: lang="texinfo" linenumbers="False"
(objectCategory=domain)
}}}


==== Find all account that do not require a password ====
{{{code: lang="texinfo" linenumbers="False"
(&(objectCategory=person)(objectClass=user)(userAccountControl:1.2.840.113556.1.4.803:=32))
}}}


==== Find all computers ====
{{{code: lang="texinfo" linenumbers="False"
(objectCategory=computer)
}}}


===== Examples =====

==== Find webservers ====
{{{code: lang="sh" linenumbers="False"
ldapsearch -LLL -h 192.168.177.10 -p 666 -D administrator@corp.com -w lab -b "dc=corp,dc=com" "servicePrincipalName=*http*"
}}}

* Connects to 192.168.177.10:666
* Used dn=administrator@corp.com to login
* Uses lab as password
* Uses the domain as search base
* Looks for all entries that have http in the servicePrincipalName

==== Find all users ====
{{{code: lang="sh" linenumbers="False"
ldapsearch -D <dn> -b "cn=users,dc=<domain>,dc=<subdomain>" -h <host> | grep sAMAccountName:
}}}


Find all SPN's
{{{code: lang="sh" linenumbers="False"
ldapsearch -LLL -H ldap://ip -D <user>@<domain>.<tld> -w <password> -b "dc=<domain>,dc=<tld>" "servicePrincipalName=*" | grep servicePrincipalName
}}}



===== Handy list of queries =====
https://social.technet.microsoft.com/wiki/contents/articles/5392.active-directory-ldap-syntax-filters.aspx

There are already some script in [[/opt/ldap_tools.]]

General format is: ldapsearch -LLL -x -H [[ldap://<ip]]> -b 'dc=<domain>,dc=<tld>' -s sub "<subquery>"


