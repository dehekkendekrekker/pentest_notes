Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2021-10-17T18:32:37-05:00

====== ssh ======
Created Sunday 17 October 2021

===== Description =====

Secure Shell. 

===== Installation =====
{{{code: lang="sh" linenumbers="False"
sudo apt install ssh
}}}


===== Usage =====
{{{code: lang="sh" linenumbers="False"
ssh [options] dest [command]
}}}


===== Options =====
{{{code: lang="texinfo" linenumbers="False"
-i <file>																Identity to use. <file> points to private key
-v																		Verbose output
-V																		Output version
-L <[listening_addr:]listening_port:remote_host:remote_port>			Setup local port forwarding
-R <[listening_addr:]listening_port:remote_host:remote_port>			Setup remote port forwarding
-D <[listening_addr:]listening_port>									Setup dynamic port forwarding
-N    																	Do not execute a remote command.  This is useful for just forwarding ports.
-f 																		Requests ssh to go to background just before command execution. This implies -n.
}}}


==== Local port forwarding ====
* A connection is made TO the target server.
* A listening socket on the attacker's machine will be setup
* Any connection made with the local socket is forwarded to another socket through the connection identified by remote_host:remote_port
* This can be done when it's possible to make a connection from the attacker's machine to the target

==== Remote port forwarding ====
* A connection is made FROM the target server. In case the target does not allow incoming SSH connections, but does allow outgoing.
* The listening socket will be setup on the attacker's machine
* Any connection made with the local socket is forwarded to another socket through the connection identified by remote_host:remote_port
* In short, it's the same a Local port forwarding, except the connection is made from target to attacker
* WARNING: This requires an interactive shell, because the reverse connection asks for a password.



===== Examples =====

==== Local port forwarding ====
{{{code: lang="sh" linenumbers="False"
ssh -L80:127.0.0.1:80 user@remotehost	
}}}

* Sets up local port forwarding
* Forwards port 80 on the localmachine to 127.0.0.1:80 of THE REMOTE MACHINE

==== Remote port forwarding ====
{{{code: lang="sh" linenumbers="False"
ssh target			# Get into the target machine. This serves as an example. In reality it'll be likely a revshell
ssh -R <local port>:<other machine on the network>:<port> <user>@<attacker machine>
}}}

* Sets up remote port forwarding
* Forwards port <local port> of the attacker's machine to <other machine on the network>:<port>


==== Dynamic port forwarding ====
{{{code: lang="sh" linenumbers="False"
ssh -D 9095 <user>@<host>
proxychains nmap -sT <ip>
}}}

* Sets up a SOCKS4 proxy listening on 0.0.0.0:9095 and will forward all connections to <host>
* Tunnels the nmap traffic through the proxy.
* Beware NMAP support for proxies is limited






===== SEE =====
[[Technologies:SSH]]
https://www.tecmint.com/restrict-ssh-user-to-directory-using-chrooted-jail/
[[proxychains]]
[[Port redirection and tunneling]]
