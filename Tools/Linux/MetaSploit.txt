Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2020-02-11T16:31:57-05:00

====== MetaSploit ======
Created Tuesday 11 February 2020

===== Description =====
* Exploitation framework

===== Website =====
https://www.metasploit.com

===== Installation =====
* Kali: Installed by default

===== Setup =====

==== Setup postgresql ====
{{{code: lang="sh" linenumbers="False"
sudo sytemctl start postgresql			# Start for just this session
sudo sytemctl enable postgresql			# Start at boot

sudo msfdb init							# Init new database for metasploit
}}}


==== Start ====
{{{code: lang="sh" linenumbers="False"
msfconsole -q							# The -q suppresses the ASCII banner
}}}



===== Commands =====
{{{code: lang="texinfo" linenumbers="False"
use <module|idx>						Opens the context of <module>. You can also use <idx> when displayed in a list.
back									leaves the current context and goes back to the main prompt
previous								leaves the current context and opens the previous context
show options							Shows the options for the currently selected module
set <option> <value>					Sets <option>
setg <option> <value>					Sets <option> globally
unset <option>							Unsets <option>
unsetg <option>							Unsets <options globally
run	[-j]								Runs the module. -j means the module will run as a background job
info [<idx>|<modulename>]				Displays module information by module name or index. When no param is supplied, it show info for the current context


services [<option>]	[<ip>]				Displays a list of services + ports. ei, the results of scans. Filters on <ip>, wildcards allowed
options:
	-h									displays help information
	-p <portnr>							Searches for <portnr>
	-s <service>				f		Searches for <name> in "name" field
	-o <file>							Send output to file in .csv format
	--rhosts							Adds the ip's in the resultset to RHOSTS
	
db_nmap <nmap options>					A wrapper around nmap,which sends it's results to the MS DB
hosts									Lists all discovered hosts

workspace [<options>] [<name>]			Lists workspaces. When <name> is provided, switches to workspace <name>
options:
	-a <name>							Add workspace <name> and switches to it
	-d <name>							Deletes workspace <name> and switches back to default
	
show auxiliary							Displays a list of aux modules

search <options>
options:
	-h									Display help
	type:<type>							Search for module type. eg: auxiliary
	name:<name>							Search for modules where <name> in name
	
	
creds									Displays known credentials


# Exploit modules
show payloads							Displays a list of compatible exploits
set payload <name>|<idx>				Sets the payload to be used with the exploit


# Modules is general
show advanced							Displays advanced options for the module

generate <options>						Generates the currently selected payload. Uses the same options as msfvenom.

jobs <options>							Interacts with jobs running on the system
	-k <num>							Kills job with id <num>
	-K									Kills all jobs


sessions <option>						Interacts with shell sessions
	-l									Lists all running rev-shell sessions
	-i <num>							Interact with session <num>
	-K 									Kill all active sessions
	

# Pivoting
route add <ip>/<netmask <sessio_id>		Adds a subnet to the session id, so that when you perform operation on the subnet(scanning) it'll go to the host in the sess
route print								Display MSF routing table


}}}


===== module multi/handler =====
* Receives connection from both staged and unstaged reverse connections

{{{code: lang="texinfo" linenumbers="False"
use multi/handler
set payload <payload> 			# Must be the same as the one connecting back
# Fiddle with options here
run -j							# Runs the listener as a background job, so we can continue working
}}}

See [[+modules:multi handler]] for more details


===== Pivoting to other networks =====
* Once you identified a host a being part of multiple networks (ipconfig / ip a)
* You'll need an active (meterpreter?) session to te target host
* Attach the subnet you want to pivot into to the session
* Now, you can portscan using the  auxiliary/scanner/portscan/tcp module
* db_nmap DOES NOT WORK like this


===== SEE =====
Cheat sheet: https://www.andreafortuna.org/2017/12/11/metasploit-console-my-own-cheatsheet/
[[+msfvenom]]
[[+payloads:meterpreter]]




