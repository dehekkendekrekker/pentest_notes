Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2021-10-28T17:12:40-05:00

====== Active Directory ======
Created Thursday 28 October 2021

Typically,  an  attack  against  Active  Directory  infrastructure  begins  with  a  successful  exploit  or client-side  attack  against  either  a  domain  workstation  or  server  followed  by  enumeration  of  the AD environment.

===== Groups =====
* We want to target accounts in high-value groups.
* For AD this is the Domain Admins group
* Getting an account in this group will give complete access to the domain

Also, we can compromise the Domain Controller itself

===== PDC =====
* A Domain Controller with this property set is called the Primary Domain Controller, and has the most up-to-date information on users/groups/security


===== Enumeration =====

==== Get all users of the domain ====
{{{code: lang="sh" linenumbers="False"
net user /domain
}}}

* Only admins can execute this command succesfully (Current security context is not associated with an Active Directory domain or forest.)

==== Finding the domain name ====
{{{code: lang="powershell" linenumbers="False"
[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()
}}}

* Runs this as a powershell command

==== Extract all accounts in use as SPN using built in MS tools ====
{{{code: lang="sh" linenumbers="False"
setspn  -Q */*
}}}


Enumerate SPN using powershell
See [[Tools:Windows:PowerShell:Get-SPN.ps1]]



==== Using powerview ====
* See [[Tools:Windows:PowerShell:PowerView.ps1]]

==== Using bloodhound / sharphound ====
* See [[Tools:Linux:BloodHound]]

===== Authentication =====


===== SEE =====
[[Technologies:Windows:Active Directory]]
[[Tools:Linux:ldapsearch]]
