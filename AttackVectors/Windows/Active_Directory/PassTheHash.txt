Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2021-11-01T10:49:35-05:00

====== PassTheHash ======
Created Monday 01 November 2021

This technique uses an NTLM hash to execute a command on a system. This is a ligitimate use of the hash. Though, an attacker should not have the hash in the first place.

===== Tools =====
* PsExec from Metasploit
* Passing-the-hash toolkit
* Impacket

The above tools work by logging into SMB and perform authentication using the NTLM hash

* Most  tools  built  to  exploit  PtH  create  and  start  a  Windows  service  (for  example cmd.exeor  an instance  of  PowerShell)  and  communicate  with  it  using Named Pipes.
* This  is  done  using  the Service Control Manager API

===== Requirements =====
* A SMB connection (TCP 445).
* The File and Print feature must be enabled.
These requirements are commonly enabled
* Requires access to $Admin, a special admin share



===== Limitations =====
* This  method  works  for  Active  Directory  domain  accounts  and  the  built-in  local  administrator account. 
* Since the 2014 [[https://support.microsoft.com/en-us/help/2871997/microsoft-security-advisory-update-to-improve-credentials-protection-a|security update]] this technique can not be used to authenticate as any other local admin account.
* You CAN perform Pass-The-Hash attacks with NTLM hashes.
* You CANNOT perfor Pass-The_hash with NetNTLM   NTLMv2 hashes

==== Example ====
See [[Tools:Linux:pth:pth-winexe]] for an example how to deploy this attack
