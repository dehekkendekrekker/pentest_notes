Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2021-10-22T16:15:58-05:00

====== Kernel Vulnerabilities ======
Created Friday 22 October 2021

It's of paramount importance that we enumerate the target system well before attempting a kernel-level exploit. Failure could result in a system crash, rendering it inoperable.

First, some generic system information
{{{code: lang="sh" linenumbers="False"
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type"
}}}


Attacking the kernel itself should be a last resort. It's often easier to try to attack 3rd party drivers.

To enumerate the drivers on a system:
{{{code: lang="sh" linenumbers="False"
driverquery /v
}}}

=== Remarks ===
* The majority of results will be microsoft drivers and a limited amount of 3rd party drivers
* If a driver shows up as stopped, we can still interact with it as it is loaded in the kernel

===== Search for exploit =====
If you've found a candidate, search for an exploit:
{{{code: lang="sh" linenumbers="False"
searchsploit <driver>
}}}

Then, move the source code of the exploit, so it can be analyzed
{{{code: lang="sh" linenumbers="False"
searchsploit -m <id>
}}}

Take good note of any versions of the target driver mentioned in the header.

===== Verfify versions =====
Even though drivers are usually installed here:
{{{code: lang="texinfo" linenumbers="False"
C:\Windows\System32\DRIVERS
}}}

The package the driver belongs to is usually installed in C:\Program Files\<package>

Try to find any .inf files where accurate version info may be found.

Once the versions found match up with the exploit, the target seems vulnerable.

===== Compilation =====
Now it's time to compile the code for the exploit.
This can be done on the target system itself, or by cross compilation:

==== Cross compilation from linux ====
{{{code: lang="sh" linenumbers="False"
i686-w64-mingw32-gcc <file> -o <binary>
}}}

==== On target system: ====

If mingw64 is installed
{{{code: lang="texinfo" linenumbers="False"
cd c:\Program Files\mingw-w64\<someotherdir>
./mingw-w64.bat			# This sets up the correct path
gcc <exploit.c> -o <exploit.exe>
}}}



===== Run the exploit =====
Now running the exploit should yield a result.



===== SEE =====
[[Tools:Linux:mingw-w64]]
[[Tools:Linux:searchsploit]]

